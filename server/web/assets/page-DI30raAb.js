import{b as M,u as $,r as t,l as n,j as e}from"./index-CA_1fxgT.js";import{B as h}from"./base-layout-D13ImLfm.js";import{B as r}from"./button-B2pmM69s.js";import{c as B,t as l,L as b,I as z,C,e as D}from"./createLucideIcon-B63Zln4e.js";import{f as p,g as O,m as A,h as H,i as V,j as q,k as R,T as U,l as G,E as J,D as k,P as K}from"./index-RthcLIEM.js";/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],W=B("star",Q);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Y=B("users",X);function re(){const{id:i}=M(),S=$(),[d,L]=t.useState(null),[m,j]=t.useState([]),[F,u]=t.useState(!0),[T,o]=t.useState(!1),[c,g]=t.useState(!1),[x,f]=t.useState(""),[N,v]=t.useState("");t.useEffect(()=>{i&&E()},[i]);const E=async()=>{if(i)try{u(!0);const[s,a]=await Promise.all([n.getSpace(i),n.listBases({spaceId:i})]);L(s),j(a)}catch(s){console.error("Failed to load space:",s),l.error(s?.message||"加载空间失败")}finally{u(!1)}},P=async()=>{if(!x.trim()||!i){l.error("请输入数据库名称");return}try{g(!0);const s=await n.createBase({spaceId:i,name:x.trim(),description:N.trim()||void 0});l.success("创建数据库成功"),o(!1),f(""),v(""),j([...m,s])}catch(s){console.error("Failed to create base:",s),l.error(s?.message||"创建数据库失败")}finally{g(!1)}},_=async s=>{try{const a=await n.listTables({baseId:s});if(a.length===0){l.error("该数据库中没有表格");return}const y=a[0],w=await n.listViews({tableId:y.id});if(w.length===0){l.error("该表格中没有视图");return}const I=w[0];S(`/base/${s}/${y.id}/${I.id}`)}catch(a){console.error("Failed to navigate to base:",a),l.error(a?.message||"打开数据库失败")}};return F?e.jsx(h,{children:e.jsxs("div",{className:"px-4 lg:px-6 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(p,{className:"h-8 w-64"}),e.jsx(p,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((s,a)=>e.jsx(p,{className:"h-32"},a))})]})}):d?e.jsx(h,{children:e.jsxs("div",{className:"px-4 lg:px-6 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:d.name}),e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-muted text-muted-foreground",children:"免费版"}),e.jsx(r,{variant:"link",className:"h-auto p-0 text-sm",children:"升级"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(O,{open:T,onOpenChange:o,children:[e.jsx(A,{asChild:!0,children:e.jsx(r,{children:"创建数据库"})}),e.jsxs(H,{children:[e.jsxs(V,{children:[e.jsx(q,{children:"创建数据库"}),e.jsxs(R,{children:['在 "',d.name,'" 空间中创建一个新的数据库']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"base-name",children:"数据库名称 *"}),e.jsx(z,{id:"base-name",placeholder:"例如：用户管理",value:x,onChange:s=>f(s.target.value),disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"base-description",children:"描述（可选）"}),e.jsx(U,{id:"base-description",placeholder:"简要描述这个数据库的用途",value:N,onChange:s=>v(s.target.value),disabled:c,rows:3})]})]}),e.jsxs(G,{children:[e.jsx(r,{variant:"outline",onClick:()=>o(!1),disabled:c,children:"取消"}),e.jsx(r,{onClick:P,disabled:c,children:c?"创建中...":"创建"})]})]})]}),e.jsxs(r,{variant:"outline",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"邀请"]}),e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),m.length===0?e.jsx(C,{children:e.jsxs(D,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(k,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"暂无数据库"}),e.jsxs(r,{onClick:()=>o(!0),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"创建第一个数据库"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(s=>e.jsx(C,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>_(s.id),children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(k,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground truncate mt-1",children:s.description})]})]})})},s.id))})]})}):e.jsx(h,{children:e.jsx("div",{className:"px-4 lg:px-6 py-6",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"空间不存在"})})})}export{re as default};
