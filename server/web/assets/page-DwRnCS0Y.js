import{r as i,j as e,c as x,u as $,l as f}from"./index-CA_1fxgT.js";import{E,F as M,u as H,B as z}from"./base-layout-D13ImLfm.js";import{D as b,a as K,b as O,E as q,c as A,d as N,S as R,e as G,P as w,f as v,g as J,h as Q,i as U,j as V,k as W,T as X,l as Y}from"./index-RthcLIEM.js";import{B as d}from"./button-B2pmM69s.js";import{c as Z,C as ee,t as l,L,I as ae}from"./createLucideIcon-B63Zln4e.js";import{T as se}from"./trash-2-BWWODerP.js";/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],te=Z("sparkles",re);function ie({base:n,onClick:s,onEdit:p,onDelete:g}){const[h,o]=i.useState(!1);return e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-200",children:e.jsxs(ee,{className:x("group relative cursor-pointer overflow-hidden","border border-gray-200 dark:border-gray-800","transition-all duration-200 ease-[cubic-bezier(0.4,0,0.2,1)]","hover:border-gray-300 dark:hover:border-gray-700","hover:shadow-md hover:-translate-y-0.5","active:shadow-sm active:scale-[0.98]"),onClick:s,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:x("flex h-11 w-11 shrink-0 items-center justify-center rounded-lg","bg-gradient-to-br from-primary/10 to-primary/5","transition-all duration-200","group-hover:from-primary/20 group-hover:to-primary/10"),children:e.jsx(b,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate group-hover:text-primary transition-colors duration-200",children:n.name}),n.description&&e.jsx("p",{className:"mt-0.5 text-sm text-gray-500 dark:text-gray-400 truncate",children:n.description})]}),e.jsx("div",{className:x("transition-all duration-150",h?"opacity-100 scale-100":"opacity-0 scale-95"),children:e.jsxs(K,{children:[e.jsx(O,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 shrink-0",onClick:t=>t.stopPropagation(),children:e.jsx(q,{className:"h-4 w-4"})})}),e.jsxs(A,{align:"end",className:"w-44",children:[e.jsxs(N,{onClick:t=>{t.stopPropagation(),s?.()},children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"打开数据库"})]}),e.jsxs(N,{onClick:t=>{t.stopPropagation(),p?.()},children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"编辑"})]}),e.jsx(G,{}),e.jsxs(N,{onClick:t=>{t.stopPropagation(),g?.()},className:"text-red-600 focus:text-red-600",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"删除"})]})]})]})})]}),e.jsxs("div",{className:x("mt-2 flex items-center gap-1.5 text-xs text-gray-400 overflow-hidden transition-all duration-150",h?"opacity-100 max-h-6":"opacity-0 max-h-0"),children:[e.jsx("span",{children:"点击打开"}),e.jsx(E,{className:"h-3 w-3"})]})]})]})}),e.jsx("div",{className:x("absolute left-0 top-0 bottom-0 w-0.5 bg-primary transition-all duration-200 origin-center",h?"opacity-100 scale-y-100":"opacity-0 scale-y-0")})]})})}function ne({type:n,onAction:s}){return n==="spaces"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"relative mb-6 animate-in zoom-in-95 duration-500 delay-100",children:[e.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-2xl bg-gradient-to-br from-gray-100 to-gray-50 dark:from-gray-800 dark:to-gray-900",children:e.jsx(M,{className:"h-10 w-10 text-gray-400"})}),e.jsx("div",{className:"absolute -right-1 -top-1 animate-[wiggle_2s_ease-in-out_infinite]",children:e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-primary/10",children:e.jsx(te,{className:"h-3.5 w-3.5 text-primary"})})})]}),e.jsxs("div",{className:"text-center animate-in fade-in duration-300 delay-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"开始您的第一个项目"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-sm",children:"创建一个空间来组织您的数据库和表格"})]}),e.jsx("div",{className:"mt-6 animate-in fade-in slide-in-from-bottom-2 duration-300 delay-300",children:e.jsxs(d,{size:"lg",onClick:s,className:"gap-2 shadow-sm",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"创建第一个空间"})]})}),e.jsxs("div",{className:"mt-8 flex items-center gap-2 text-xs text-gray-400 animate-in fade-in duration-300 delay-[400ms]",children:[e.jsx("span",{children:"快捷键："}),e.jsx("kbd",{className:"px-2 py-1 rounded bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 font-mono",children:"⌘ N"})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 animate-in fade-in duration-200",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-xl bg-gray-50 dark:bg-gray-900 mb-4",children:e.jsx(M,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"该空间暂无数据库"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:"创建您的第一个数据库开始使用"}),e.jsxs(d,{size:"sm",variant:"outline",onClick:s,className:"gap-1.5",children:[e.jsx(w,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"创建数据库"})]})]})}function he(){const{spaces:n,selectedSpace:s,setSpaces:p,setSelectedSpace:g,addSpace:h}=H(),[o,t]=i.useState([]),[F,k]=i.useState(!0),[I,c]=i.useState(!1),[m,D]=i.useState(!1),[j,y]=i.useState(""),[C,u]=i.useState(""),P=$();i.useEffect(()=>{S()},[]),i.useEffect(()=>{s?B(s.id):t([])},[s]);const S=async()=>{try{k(!0);const a=await f.listSpaces();p(a),a.length>0&&!s&&g(a[0])}catch(a){console.error("Failed to load spaces:",a),l.error(a?.message||"加载空间失败")}finally{k(!1)}},B=async a=>{try{const r=await f.listBases({spaceId:a});t(r)}catch(r){console.error("Failed to load bases:",r),l.error("加载数据库失败"),t([])}},T=async()=>{if(!j.trim()||!s){l.error("请输入数据库名称");return}try{D(!0);const a=await f.createBase({spaceId:s.id,name:j.trim(),description:C.trim()||void 0});l.success("创建数据库成功"),c(!1),y(""),u(""),B(s.id)}catch(a){console.error("Failed to create base:",a),l.error(a?.message||"创建数据库失败")}finally{D(!1)}},_=a=>{P(`/base/${a}`)};return i.useEffect(()=>{const a=r=>{r.key==="n"&&(r.metaKey||r.ctrlKey)&&(r.preventDefault(),c(!0))};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]),F?e.jsx(z,{children:e.jsxs("div",{className:"px-4 lg:px-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{className:"h-9 w-40"}),e.jsx(v,{className:"h-9 w-32"})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-1 lg:grid-cols-1",children:[...Array(2)].map((a,r)=>e.jsx("div",{className:"space-y-4",children:e.jsx(v,{className:"h-40 w-full rounded-xl"})},r))})]})}):e.jsx(z,{spaces:n,onCreateSpace:()=>{S()},children:e.jsxs("div",{className:"px-4 lg:px-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-gray-900 dark:text-gray-100",children:s?`${s.name} 数据库`:"数据库管理"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:s?`管理 ${s.name} 空间中的数据库`:"请选择一个空间来查看数据库"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-sm text-gray-500 animate-in fade-in zoom-in-95 duration-200 delay-100",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:"按"}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded",children:"⌘ K"}),e.jsx("span",{children:"快速操作"})]}),s&&e.jsxs(d,{onClick:()=>c(!0),className:"gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"创建数据库"})]})]})]}),e.jsx(J,{open:I,onOpenChange:c,children:e.jsxs(Q,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"创建数据库"}),e.jsxs(W,{children:["在 ",s?.name," 空间中创建一个新的数据库"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"base-name",children:"数据库名称 *"}),e.jsx(ae,{id:"base-name",placeholder:"例如：用户管理",value:j,onChange:a=>y(a.target.value),disabled:m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"base-description",children:"描述（可选）"}),e.jsx(X,{id:"base-description",placeholder:"简要描述这个数据库的用途",value:C,onChange:a=>u(a.target.value),disabled:m,rows:3})]})]}),e.jsxs(Y,{children:[e.jsx(d,{variant:"outline",onClick:()=>{c(!1),y(""),u("")},disabled:m,children:"取消"}),e.jsx(d,{onClick:T,disabled:m,children:m?"创建中...":"创建"})]})]})}),s?o.length===0?e.jsx(ne,{type:"bases",onAction:()=>c(!0)}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map((a,r)=>e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-200",style:{animationDelay:`${r*50}ms`},children:e.jsx(ie,{base:a,onClick:()=>_(a.id),onEdit:()=>{l.info("编辑功能开发中")},onDelete:()=>{l.info("删除功能开发中")}})},a.id))}):e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"请选择一个空间"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"从左侧选择空间来查看其中的数据库"})]})})]})})}export{he as default};
