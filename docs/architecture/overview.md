# LuckDB 架构概览

## 系统架构

LuckDB 采用现代化的 Monorepo 架构，前后端分离，基于领域驱动设计（DDD）。

```
┌─────────────────────────────────────────────────────────┐
│                      Frontend Layer                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │  Web App │  │ Mobile   │  │  Admin   │  │ Desktop │ │
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────┘
                          │
                    REST API / WebSocket
                          │
┌─────────────────────────────────────────────────────────┐
│                      Backend Layer                       │
│  ┌──────────────────────────────────────────────────┐  │
│  │         Interface Layer (HTTP/gRPC/WS)           │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │         Application Layer (Services)             │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │         Domain Layer (Business Logic)            │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │    Infrastructure Layer (DB/Cache/Storage)       │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                          │
           ┌──────────────┼──────────────┐
           │              │              │
      ┌────▼────┐    ┌───▼────┐    ┌───▼────┐
      │PostgreSQL│    │ Redis  │    │ S3/OSS │
      └─────────┘    └────────┘    └────────┘
```

## 技术栈

### 前端
- **框架**: Next.js 14 (App Router)
- **语言**: TypeScript
- **状态管理**: Zustand
- **UI**: Tailwind CSS
- **构建工具**: Turbo + pnpm

### 后端
- **语言**: Go 1.21+
- **Web 框架**: Gin
- **ORM**: GORM
- **数据库**: PostgreSQL
- **缓存**: Redis
- **实时通信**: WebSocket

## 分层架构

### 1. Interface Layer (接口层)
- HTTP Handlers
- WebSocket Handlers
- gRPC Services (可选)
- 中间件 (认证、日志、限流等)

### 2. Application Layer (应用层)
- 业务服务编排
- DTO 转换
- 事务管理
- 权限控制

### 3. Domain Layer (领域层)
- 实体定义
- 业务规则
- 领域服务
- 仓储接口

### 4. Infrastructure Layer (基础设施层)
- 数据库实现
- 缓存实现
- 文件存储
- 第三方服务集成

## Monorepo 结构

```
luckdb/
├── apps/                 # 应用层
│   └── web/             # Web 应用
├── packages/            # 共享包
│   ├── ui/             # UI 组件库
│   ├── sdk/            # SDK
│   ├── core/           # 核心逻辑
│   └── utils/          # 工具函数
├── server/             # 后端服务
└── docs/               # 文档
```

## 数据流

### 读取流程
```
Client → API → Service → Repository → Cache/DB → Repository → Service → API → Client
```

### 写入流程
```
Client → API → Service → Repository → DB → Invalidate Cache → Event → WebSocket → Client
```

## 核心模块

### Base (基地)
- 多个表格的容器
- 权限隔离单元
- 资源配额管理

### Table (表格)
- 数据存储的基本单位
- 字段定义和管理
- 数据验证规则

### Field (字段)
- 支持多种字段类型
- 字段配置和验证
- 关联字段支持

### View (视图)
- 多种视图类型（表格、看板、日历等）
- 筛选、排序、分组
- 自定义显示

### Record (记录)
- 数据的基本单元
- 版本控制
- 协作编辑

## 扩展性设计

### 插件系统
- Hook 机制
- 自定义字段类型
- 自定义视图类型

### API 扩展
- RESTful API
- GraphQL (计划中)
- WebSocket 实时 API

### 存储扩展
- 多数据库支持 (PostgreSQL, MySQL, SQLite)
- 对象存储支持 (S3, OSS, MinIO)
- 搜索引擎集成 (Elasticsearch)

## 安全性

### 认证
- JWT Token
- OAuth 2.0
- SSO (计划中)

### 授权
- RBAC (基于角色的访问控制)
- 行级权限
- 列级权限

### 数据安全
- 数据加密 (传输 + 存储)
- 审计日志
- 备份恢复

## 性能优化

### 缓存策略
- 多层缓存 (内存 + Redis)
- 查询结果缓存
- 静态资源 CDN

### 数据库优化
- 索引优化
- 查询优化
- 连接池管理

### 前端优化
- 代码分割
- 懒加载
- 服务端渲染

## 可观测性

### 日志
- 结构化日志
- 日志聚合 (ELK Stack)
- 分布式追踪

### 监控
- 性能监控
- 错误追踪
- 业务指标

### 告警
- 自动告警
- 告警聚合
- On-call 管理

## 部署架构

### 开发环境
- Docker Compose
- 本地数据库
- 热重载

### 生产环境
- Kubernetes
- 负载均衡
- 自动扩缩容
- 高可用部署

## 未来规划

- [ ] 移动端应用 (React Native)
- [ ] 桌面应用 (Electron)
- [ ] AI 功能增强
- [ ] 实时协作优化
- [ ] 更多视图类型
- [ ] 自动化工作流
- [ ] API 市场

